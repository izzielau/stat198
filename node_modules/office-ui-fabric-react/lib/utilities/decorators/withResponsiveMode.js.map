{"version":3,"file":"withResponsiveMode.js","sourceRoot":"../src/","sources":["utilities/decorators/withResponsiveMode.tsx"],"names":[],"mappings":"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","sourcesContent":["import * as React from 'react';\nimport { findDOMNode } from 'react-dom';\nimport { BaseDecorator } from './BaseDecorator';\nimport { getWindow, hoistStatics, EventGroup } from '../../Utilities';\n\nexport interface IWithResponsiveModeState {\n  responsiveMode?: ResponsiveMode;\n}\n\nexport enum ResponsiveMode {\n  small = 0,\n  medium = 1,\n  large = 2,\n  xLarge = 3,\n  xxLarge = 4,\n  xxxLarge = 5,\n  unknown = 999,\n}\n\nconst RESPONSIVE_MAX_CONSTRAINT = [479, 639, 1023, 1365, 1919, 99999999];\n\n/**\n * User specified mode to default to, useful for server side rendering scenarios.\n */\nlet _defaultMode: ResponsiveMode | undefined;\n\n/**\n * Tracking the last mode we successfully rendered, which allows us to\n * paint initial renders with the correct size.\n */\nlet _lastMode: ResponsiveMode | undefined;\n\n/**\n * Allows a server rendered scenario to provide a default responsive mode.\n */\nexport function setResponsiveMode(responsiveMode: ResponsiveMode | undefined): void {\n  _defaultMode = responsiveMode;\n}\n\n/**\n * Initializes the responsive mode to the current window size. This can be used to avoid\n * a re-render during first component mount since the window would otherwise not be measured\n * until after mounting.\n */\nexport function initializeResponsiveMode(element?: HTMLElement): void {\n  if (typeof window !== 'undefined') {\n    const currentWindow = (element && getWindow(element)) || window;\n\n    getResponsiveMode(currentWindow);\n  }\n}\n\nexport function withResponsiveMode<TProps extends { responsiveMode?: ResponsiveMode }, TState>(\n  ComposedComponent: new (props: TProps, ...args: any[]) => React.Component<TProps, TState>,\n): any {\n  const resultClass = class WithResponsiveMode extends BaseDecorator<TProps, IWithResponsiveModeState> {\n    private _events: EventGroup;\n\n    constructor(props: TProps) {\n      super(props);\n      this._events = new EventGroup(this);\n      this._updateComposedComponentRef = this._updateComposedComponentRef.bind(this);\n\n      this.state = {\n        responsiveMode: _defaultMode || _lastMode || ResponsiveMode.large,\n      };\n    }\n\n    public componentDidMount(): void {\n      this._events.on(window, 'resize', this._onResize);\n      this._onResize();\n    }\n\n    public componentWillUnmount(): void {\n      this._events.dispose();\n    }\n\n    public render(): JSX.Element | null {\n      const { responsiveMode } = this.state;\n\n      return responsiveMode === ResponsiveMode.unknown ? null : (\n        <ComposedComponent\n          ref={this._updateComposedComponentRef}\n          responsiveMode={responsiveMode}\n          {...(this.props as any)}\n        />\n      );\n    }\n\n    private _onResize = () => {\n      const element = findDOMNode(this) as Element;\n      const currentWindow = (element && getWindow(element)) || window;\n      const responsiveMode = getResponsiveMode(currentWindow);\n\n      if (responsiveMode !== this.state.responsiveMode) {\n        this.setState({\n          responsiveMode,\n        });\n      }\n    };\n  };\n  return hoistStatics(ComposedComponent, resultClass);\n}\n\nfunction getResponsiveMode(currentWindow: Window | undefined): ResponsiveMode {\n  let responsiveMode = ResponsiveMode.small;\n\n  if (currentWindow) {\n    try {\n      while (currentWindow.innerWidth > RESPONSIVE_MAX_CONSTRAINT[responsiveMode]) {\n        responsiveMode++;\n      }\n    } catch (e) {\n      // Return a best effort result in cases where we're in the browser but it throws on getting innerWidth.\n      responsiveMode = _defaultMode || _lastMode || ResponsiveMode.large;\n    }\n\n    // Tracking last mode just gives us a better default in future renders,\n    // which avoids starting with the wrong value if we've measured once.\n    _lastMode = responsiveMode;\n  } else {\n    if (_defaultMode !== undefined) {\n      responsiveMode = _defaultMode;\n    } else {\n      throw new Error(\n        'Content was rendered in a server environment without providing a default responsive mode. ' +\n          'Call setResponsiveMode to define what the responsive mode is.',\n      );\n    }\n  }\n\n  return responsiveMode;\n}\n"]}