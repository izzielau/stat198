{"ast":null,"code":"import _slicedToArray from \"/Users/mac/Desktop/projects/izzielau.github.io/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";\nimport e from \"@bundled-es-modules/pdfjs-dist/build/pdf\";\nimport t, { useRef as r, useEffect as o, useState as a, useMemo as c } from \"react\";\n\nvar n = function n(_ref) {\n  var e = _ref.file,\n      a = _ref.onDocumentComplete,\n      c = _ref.page,\n      n = _ref.scale,\n      s = _ref.rotate,\n      i = _ref.cMapUrl,\n      d = _ref.cMapPacked,\n      p = _ref.workerSrc,\n      h = _ref.withCredentials;\n\n  var u = r(null),\n      _l = l({\n    canvasEl: u,\n    file: e,\n    page: c,\n    scale: n,\n    rotate: s,\n    cMapUrl: i,\n    cMapPacked: d,\n    workerSrc: p,\n    withCredentials: h\n  }),\n      _l2 = _slicedToArray(_l, 2),\n      w = _l2[1];\n\n  return o(function () {\n    a(w);\n  }, [w]), t.createElement(\"canvas\", {\n    ref: u\n  });\n};\n\nn.defaultProps = {\n  onDocumentComplete: function onDocumentComplete() {}\n};\n\nvar l = function l(_ref2) {\n  var t = _ref2.canvasEl,\n      r = _ref2.file,\n      _ref2$scale = _ref2.scale,\n      n = _ref2$scale === void 0 ? 1 : _ref2$scale,\n      _ref2$rotate = _ref2.rotate,\n      l = _ref2$rotate === void 0 ? 0 : _ref2$rotate,\n      _ref2$page = _ref2.page,\n      s = _ref2$page === void 0 ? 1 : _ref2$page,\n      i = _ref2.cMapUrl,\n      d = _ref2.cMapPacked,\n      _ref2$workerSrc = _ref2.workerSrc,\n      p = _ref2$workerSrc === void 0 ? \"//cdnjs.cloudflare.com/ajax/libs/pdf.js/2.1.266/pdf.worker.js\" : _ref2$workerSrc,\n      _ref2$withCredentials = _ref2.withCredentials,\n      h = _ref2$withCredentials === void 0 ? !1 : _ref2$withCredentials;\n\n  var _a = a(),\n      _a2 = _slicedToArray(_a, 2),\n      u = _a2[0],\n      w = _a2[1];\n\n  o(function () {\n    e.GlobalWorkerOptions.workerSrc = p;\n  }, []), o(function () {\n    var t = {\n      url: r,\n      withCredentials: h\n    };\n    i && (t.cMapUrl = i, t.cMapPacked = d), e.getDocument(t).promise.then(w);\n  }, [r, h]), o(function () {\n    u && u.getPage(s).then(function (e) {\n      return f(e);\n    });\n  }, [u, s, n, l, t]);\n\n  var f = function f(e) {\n    var r = 0 === l ? e.rotate : e.rotate + l;\n    var o = 1;\n    o = window.devicePixelRatio;\n    var a = n * o,\n        c = e.getViewport({\n      scale: a,\n      rotation: r\n    }),\n        s = t.current;\n    if (!s) return;\n    var i = s.getContext(\"2d\");\n    s.style.width = \"\".concat(c.width / o, \"px\"), s.style.height = \"\".concat(c.height / o, \"px\"), s.height = c.height, s.width = c.width;\n    var d = {\n      canvasContext: i,\n      viewport: c\n    };\n    e.render(d);\n  },\n      m = c(function () {\n    return !u;\n  }, [u]),\n      g = c(function () {\n    return u ? u._pdfInfo.numPages : null;\n  }, [u]);\n\n  return [m, g];\n};\n\nexport default n;\nexport { l as usePdf };","map":{"version":3,"sources":["../src/index.tsx"],"names":["Pdf","file","onDocumentComplete","page","scale","rotate","cMapUrl","cMapPacked","workerSrc","withCredentials","canvasEl","useRef","numPages","usePdf","useEffect","React","ref","defaultProps","pdf","setPdf","useState","pdfjs","GlobalWorkerOptions","config","url","getDocument","promise","then","getPage","p","drawPDF","rotation","dpRatio","window","devicePixelRatio","adjustedScale","viewport","getViewport","canvas","current","canvasContext","getContext","style","width","height","renderContext","render","loading","useMemo","_pdfInfo"],"mappings":"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","sourcesContent":["import pdfjs from '@bundled-es-modules/pdfjs-dist/build/pdf';\nimport React, { useState, useEffect, useRef, useMemo } from 'react';\n\ntype ComponentProps = {\n  file: string;\n  onDocumentComplete: (numPages: number) => void;\n  page?: number;\n  scale?: number;\n  rotate?: number;\n  cMapUrl?: string;\n  cMapPacked?: boolean;\n  workerSrc?: string;\n  withCredentials?: boolean;\n};\n\nconst Pdf = ({\n  file,\n  onDocumentComplete,\n  page,\n  scale,\n  rotate,\n  cMapUrl,\n  cMapPacked,\n  workerSrc,\n  withCredentials,\n}: ComponentProps) => {\n  const canvasEl = useRef<HTMLCanvasElement>(null);\n  const [, numPages] = usePdf({\n    canvasEl,\n    file,\n    page,\n    scale,\n    rotate,\n    cMapUrl,\n    cMapPacked,\n    workerSrc,\n    withCredentials,\n  });\n\n  useEffect(() => {\n    onDocumentComplete(numPages);\n  }, [numPages]);\n\n  return <canvas ref={canvasEl} />;\n};\n\nPdf.defaultProps = {\n  onDocumentComplete: () => {},\n};\n\ntype HookProps = {\n  canvasEl: React.RefObject<HTMLCanvasElement>;\n  file: string;\n  scale?: number;\n  rotate?: number;\n  page?: number;\n  cMapUrl?: string;\n  cMapPacked?: boolean;\n  workerSrc?: string;\n  withCredentials?: boolean;\n};\n\nexport const usePdf = ({\n  canvasEl,\n  file,\n  scale = 1,\n  rotate = 0,\n  page = 1,\n  cMapUrl,\n  cMapPacked,\n  workerSrc = '//cdnjs.cloudflare.com/ajax/libs/pdf.js/2.1.266/pdf.worker.js',\n  withCredentials = false,\n}: HookProps) => {\n  const [pdf, setPdf] = useState();\n\n  useEffect(() => {\n    pdfjs.GlobalWorkerOptions.workerSrc = workerSrc;\n  }, []);\n\n  useEffect(() => {\n    const config: pdfjs.PDFSource = { url: file, withCredentials };\n    if (cMapUrl) {\n      config.cMapUrl = cMapUrl;\n      config.cMapPacked = cMapPacked;\n    }\n    pdfjs.getDocument(config).promise.then(setPdf);\n  }, [file, withCredentials]);\n\n  // handle changes\n  useEffect(() => {\n    if (pdf) {\n      pdf.getPage(page).then((p: any) => drawPDF(p));\n    }\n  }, [pdf, page, scale, rotate, canvasEl]);\n\n  // draw a page of the pdf\n  const drawPDF = (page: any) => {\n    // Because this page's rotation option overwrites pdf default rotation value,\n    // calculating page rotation option value from pdf default and this component prop rotate.\n    const rotation = rotate === 0 ? page.rotate : page.rotate + rotate;\n    let dpRatio = 1;\n    dpRatio = window.devicePixelRatio;\n    const adjustedScale = scale * dpRatio;\n    const viewport = page.getViewport({ scale: adjustedScale, rotation });\n    const canvas = canvasEl.current;\n    if (!canvas) {\n      return;\n    }\n    const canvasContext = canvas.getContext('2d');\n    canvas.style.width = `${viewport.width / dpRatio}px`;\n    canvas.style.height = `${viewport.height / dpRatio}px`;\n    canvas.height = viewport.height;\n    canvas.width = viewport.width;\n    const renderContext = {\n      canvasContext,\n      viewport,\n    };\n    page.render(renderContext);\n  };\n\n  const loading = useMemo(() => !pdf, [pdf]);\n  const numPages = useMemo(() => (pdf ? pdf._pdfInfo.numPages : null), [pdf]);\n\n  return [loading, numPages];\n};\n\nexport default Pdf;\n"]},"metadata":{},"sourceType":"module"}